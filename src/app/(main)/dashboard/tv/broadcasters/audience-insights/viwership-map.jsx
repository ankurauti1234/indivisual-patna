import React from "react";

const ViewershipMap = ({ data }) => {
  // Custom color scaling function
  const getColorScale = (value, min, max) => {
    const ratio = (value - min) / (max - min);
    const r = Math.round(187 - ratio * (187 - 21));
    const g = Math.round(222 - ratio * (222 - 101));
    const b = Math.round(251 - ratio * (251 - 192));
    return `rgb(${r}, ${g}, ${b})`;
  };

  // Get min and max viewers
  const minViewers = Math.min(...data.map((d) => d.viewers));
  const maxViewers = Math.max(...data.map((d) => d.viewers));

  // Function to get color based on viewership
  const getRegionColor = (regionName) => {
    const region = data.find((d) => d.region === regionName);
    return region
      ? getColorScale(region.viewers, minViewers, maxViewers)
      : "#e5e5e5";
  };

  // Define label positions as percentages relative to the SVG viewBox
  const labelPositions = {
    Bagmati: { x: "73%", y: "52%" },
    Gandaki: { x: "60%", y: "38%" },
    Lumbini: { x: "43%", y: "54%" },
    Karnali: { x: "22%", y: "33%" },
    Janakpur: { x: "88%", y: "61%" },
  };

  return (
    <div className="relative w-full">
      {/* Container for SVG and labels */}
      <div className="relative">
        {/* SVG Map */}
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="100%"
          height="10%"
          viewBox="0 50 690.36517 454.28867"
        >
          {/* Bagmati Province */}
          <path
            d="m 507.66161,235.81836 3.61,5.49 4.8,-0.38 3.96,-1.72 0.53,1.07 3.23,0.86 4.33,-4.08 3.57,-1.28 6.95,0.5 5.89,2.92 3.74,5.22 2.57,0.1 7.37,6.1 1.2,0.06 2.64,-1.43 12.28,10.52 1.56,3.25 0.12,3.11 5.1,8.31 0.23,1.91 -1.25,1.84 0.22,1.1 7.41,3.06 3.43,0.28 0,0 -1.45,5.86 -3.37,2.7 2.78,9.52 -0.24,2.94 -7.7,0.77 -2.21,2.77 -1.36,4.24 -3.03,4.27 -1.4,3.58 -3.2,1.33 -2.4,2.26 0.65,11.94 -6.4,4.49 -2.52,-0.53 -2.13,0.94 -0.03,3.29 -2.45,3.71 -5.85,-0.95 -2.02,0.33 -3.07,-0.83 -2.91,-1.84 -5.81,-1.44 0,0 -4.41,-2.27 -12.89,-4.27 -5.74,-4.18 -0.92,-7.39 0.71,-1.87 -1.45,-1.98 -1.74,-7.71 -1.55,-2.48 -6.02,-0.79 -9.95,-4.19 -6.89,1.85 -2.79,1.72 -3.74,-1.84 -2.49,3.44 -2.53,-0.31 -1.26,-0.86 -3.09,0.45 -1.77,-1.22 -0.4,-2.43 -2.73,-1.17 -0.86,-1.26 -4.3,0.91 -8.26,-1.68 -0.3,-1.47 2.53,-3.24 -0.81,-1.63 0.45,-1.42 2.85,-3.18 0,0 3.69,3.44 2.13,-0.3 3.14,-1.93 0.36,-1.93 -1.87,-9.74 2.23,-3.45 4.07,-3.66 0.86,-3.96 1.84,-1.57 1.27,-5.24 2.24,-1.01 1.62,0.61 1.88,-0.6 1.02,0.35 1.23,-2.43 3.25,-2.54 0.48,-6.92 1.17,-3 3.37,-2.18 1.58,-2.59 0.63,-3.72 1.99,-2.08 4.72,-1.64 0,0 3.78,1.13 4.63,-1.92 z"
            fill={getRegionColor("Bagmati")}
            className="hover:opacity-80 transition-opacity cursor-pointer"
          />
          {/* Gandaki Province */}
          <path
            d="m 413.75161,170.99836 1.2,0.53 1.46,2.89 2.48,0.61 3.15,2.07 5.39,0.72 2.65,2.63 0.86,2.09 -0.19,2.1 -1.29,2.51 -0.14,3.5 2.93,-0.84 3.24,2.15 3.16,0.87 4.26,-0.62 4.84,-1.86 6.51,2.34 0.48,2.5 2.49,4.51 -1.64,3.91 0.42,0.9 4.82,1.78 8.02,0.66 3.63,2.53 2.16,-1.95 5.71,-3.16 3.96,1.41 1.97,-0.32 3.93,-4.86 3.18,-2.48 5.92,-0.85 1.94,1.45 4.13,5.21 -1.07,1.87 0.42,4.53 -1.04,0.74 -2.1,8.05 -1.43,2.73 -2.58,13.57 0,0 -4.72,1.64 -1.99,2.08 -0.63,3.72 -1.58,2.59 -3.37,2.18 -1.17,3 -0.48,6.92 -3.25,2.54 -1.23,2.43 -1.02,-0.35 -1.88,0.6 -1.62,-0.61 -2.24,1.01 -1.27,5.24 -1.84,1.57 -0.86,3.96 -4.07,3.66 -2.23,3.45 1.87,9.74 -0.36,1.93 -3.14,1.93 -2.13,0.3 -3.69,-3.44 0,0 -4.27,-5.59 -4,0.35 -3.09,2.64 -3.24,1.58 -0.61,1.17 -8.1,2.65 2.14,6.08 -0.33,0.78 0,0 -8.18,-1.58 -2.17,2.14 -2.85,-3.49 -0.87,-4.11 -3.16,-3.95 -9.53,-0.27 -8.47,-1.33 -5.67,0.69 -12.23,-2.22 -10.59,0.12 -2.96,-2.46 -5.29,-1.54 -3.7,-0.32 -3.33,1.5 -5.46,-2.95 -2.54,-0.54 -10.69,0.91 -2.14,-0.84 -0.16,-1.01 2.31,-2.16 10.43,-2.03 1.57,-0.98 1.91,-3.68 0,0 4.67,1.64 3.59,-1.9 3.01,-3.79 0.57,-5.19 -0.82,-0.86 0.39,-1.99 2.88,-2.77 0.62,-4.27 -0.77,-1.12 1.1,-3.01 2.03,-0.42 2.05,1.36 1.96,-3.17 0.19,-1.07 -4.14,-2.67 0.35,-1.64 -1.82,-4.98 -2.26,-2.63 -4.35,-1.85 0.75,-2 1.63,-0.47 1.74,-4.91 4.5,-5.04 4.21,-3.29 -0.01,-2.25 -1.76,-3.66 0.24,-1.43 3.41,-1.92 2.25,0.65 0.6,-1.38 -1.76,-4.13 -2.21,-1.52 -1.19,-2.09 -0.07,-3.17 5.6,-2.85 4.32,-3.4 1.32,-2.26 0.53,-4.36 2.97,-0.27 3.64,2.38 1.89,-0.31 8.1,-8.24 3.26,-1.02 0,0 1.53,0.4 3.51,-1.72 z"
            fill={getRegionColor("Gandaki")}
            className="hover:opacity-80 transition-opacity cursor-pointer"
          />
          {/* Lumbini Province */}
          <path
            d="m 298.83161,245.13836 3.07,0.15 6.9,-1.77 2.5,0.27 2.57,-1.35 1.5,1.31 4.57,-0.21 0.57,1.01 -0.38,2.4 -2.35,3.39 1.44,1.56 4.23,0.77 4.15,2.7 1.57,-0.27 3.36,4.9 3.93,1.95 3.95,-1.11 1.79,1.56 3.27,1.09 1.23,1.26 1.83,6.18 0.88,0.14 0,0 -1.91,3.68 -1.57,0.98 -10.43,2.03 -2.31,2.16 0.16,1.01 2.14,0.84 10.69,-0.91 2.54,0.54 5.46,2.95 3.33,-1.5 3.7,0.32 5.29,1.54 2.96,2.46 10.59,-0.12 12.23,2.22 5.67,-0.69 8.47,1.33 9.53,0.27 3.16,3.95 0.87,4.11 2.85,3.49 2.17,-2.14 8.18,1.58 0,0 -0.58,1.75 -3.13,3.25 -3.59,1.33 -1.47,-1.11 -9.65,4.48 -1.31,1.48 -2.78,0.82 -0.51,1.21 -3.48,1.38 -2.26,4.77 -1.86,1.83 -4.34,0.88 -16.17,0.95 -0.95,0.66 0.06,1.11 4.25,1.19 -1.96,2.64 -1.39,3.86 0,0 -1.2,-0.61 -2.02,0.98 -4.03,0.55 -2.31,-1.22 -0.93,0.98 -0.43,1.66 4.85,5.06 -1.94,3.43 -4.25,-3.32 -20.62,-10.36 -20.78,-1.02 -0.8,0.28 0.13,1 1.13,1.35 -1.56,2.82 1.42,1.49 0.05,1.81 -1.07,1.07 -0.37,1.78 -1.65,0.81 -0.07,1.14 -1.57,1.65 -4.5,1.18 -3.26,-1.92 -0.86,-1.64 0.24,-2.1 -5.55,-4.04 -1.03,-2.04 -2.1,-1.89 -12.89,0.53 -2.94,-0.52 -7.17,-2.17 -1.07,-2.36 -1.33,-0.75 -4.17,0.48 -4.17,-0.57 -2.22,0.64 -7.52,-0.6 -0.37,-1.45 1.13,-1.05 -0.82,-2.78 1.36,-3.81 -1.69,-3.2 0.62,-2.13 -1.09,-1.05 -0.01,-1.25 -1.25,-0.27 -0.41,-0.81 0.35,-2.9 -1.07,-2.37 0.48,-2.04 -1.24,0.97 0,0 -0.11,-1.78 1.75,-1.45 7.81,1.15 2.6,-2.22 2.73,-0.5 1.39,-1.95 -1.54,-0.94 -2.89,-0.26 -3.63,-2.48 2.67,-6.99 3.87,-2.4 4.37,0.34 6.41,-2.07 7.6,-0.36 0.02,-2.34 -1.81,-2.56 -4.45,-2.74 1.06,-7.28 4.71,-4.49 1.97,-0.79 2.41,-2.78 -3.7,-2.44 0.25,-4.58 -1.19,-1.26 2.56,-2.33 3.65,-1.22 z"
            fill={getRegionColor("Lumbini")}
            className="hover:opacity-80 transition-opacity cursor-pointer"
          />
          {/* Karnali Province */}
          <path
            d="m 148.37161,147.36836 2.21,0.72 -2.04,4.21 0.47,2.5 1.76,0.52 2.05,1.9 5.95,-1.79 2.94,0.75 1.98,3.49 8.9,1.12 1.85,2.52 3.07,1.78 4.14,-2.66 2.99,0.96 3.36,-1.05 2,-2 2.72,0.15 4.79,3.38 3.03,0.35 2.79,-1.5 1.2,-3.77 3.24,-4.43 12.42,-7.08 6.18,0.96 5.18,-0.1 1.14,0.9 -0.84,1.76 -0.18,9.45 2.03,1.6 6.73,-2.12 7.37,2.21 0,0 -5.08,2.98 -0.39,6.57 -2.56,2.87 -9.02,4.88 -4.74,6.28 -3.85,-0.59 -2.59,3.38 0.6,4.34 -2.37,1.63 -5.42,2.1 -2.44,8.08 -11.7,-2.77 -2.41,-0.15 -2.12,1.07 -1.23,4.52 2.04,4.61 0.35,4.23 -2.45,4.39 -3,2.62 1.57,4.3 -0.16,2.15 -5.25,6.29 -2.6,-0.1 -7.04,-4.88 -4.78,-1.68 -3.19,2.99 0.18,1.06 -1.26,2.63 0.19,1.58 3.49,3.13 1.48,2.26 4.01,-0.4 2.67,1.21 0.13,1.01 1.86,1.49 2.05,0.26 1.7,1.33 0.62,2.43 8.08,4.15 1.39,3.17 3.4,4.36 7.97,2.37 0.84,3.7 2.04,0.36 1.51,1.75 -0.07,3.71 1.09,1.35 -0.28,3.56 -4.59,-0.92 -2.21,0.91 -3.6,0.18 -2.66,1.79 0,0 -9.63,-0.37 -4.67,7.63 -3.86,-0.15 -5.44,-4.39 -2.8,-0.54 -10.47,-9.6 -3.12,-0.18 -3.51,-1.37 -14.84,-8.7 0.22,-3.64 -2.25,-1.81 -1.09,-2.9 -2.07,-1.61 -4.7,-0.24 -0.78,0.87 0.6,2.22 -5.88,1.09 0.89,-2.39 -0.91,0.21 -1.19,-1 1.97,-0.76 -0.68,-3.43 -7.87,-8.78 -0.33,-4.94 -2.11,-3.56 -11.04,-2.26 -3.600005,-2.26 0,0 2.510005,-3.47 0.57,-3.24 3.05,-1.87 4.92,-4.59 3.64,-4.55 0.88,-3.19 7.28,-8.13 -0.4,-3.11 -3.92,-6.75 -1.34,-4.01 -1.12,-6.83 -2.19,0.58 -2.48,4.22 -3.29,-2.21 -0.04,-3.08 -6.4,-1.6 -5.450005,-2.71 -3.46,-5.74 7.51,-2.48 3.330005,-0.05 11.21,6.65 8.16,0.69 5.29,-1.17 1.65,2.05 2.83,-1.25 2.52,0.24 2.13,-0.73 3.51,6.83 6.05,6.35 0.58,2.39 2.01,0.92 2.59,-0.84 -1.06,-3.45 -2.25,-1.73 -1.16,-3.56 -5.49,-6.32 -0.91,-3.3 -3.38,-3.66 -0.03,-6.77 3.62,-4.92 8.23,-4.99 z"
            fill={getRegionColor("Karnali")}
            className="hover:opacity-80 transition-opacity cursor-pointer"
          />
          {/* Janakpur Province */}
          <path
            d="m 607.04161,274.71836 9.07,0.49 3.37,3.51 4.9,-2.26 2.22,-0.15 0.45,0.48 -2.63,3.9 1.47,1.8 1.09,0.01 4.23,-2.76 4.33,1.87 1.23,-2.48 -0.93,-1.58 0,0 3.54,4.41 1.35,4.5 -1.1,2.31 -0.37,4.21 2.57,7.04 -0.37,4.6 -3.27,2.03 -4.84,1.7 -2.04,4.78 -4.33,5.2 -0.89,2.17 -3.42,1.97 -4.37,5.3 -1.46,3.17 -4.75,3.98 -3.76,6.17 0.12,5.71 1.32,3.55 -2.54,5.07 1.11,1.08 3.96,0.4 10.86,7.82 -2.3,7.13 0.61,2.93 -0.38,2.16 1.22,2.54 -2.14,8.93 -1.32,1.29 -4.54,1.35 -2,2.69 -2.74,2.08 -4.02,0.3 -5.05,-2.38 -1.26,0.54 1.04,9.67 -1.07,5.52 1.4,4.09 2.34,1.38 1.71,3.74 -3.03,6.22 0,0 -0.47,-0.45 -3.45,1.45 0.07,-2.45 -5.24,-1.89 -1.66,-1.62 -3.74,-0.84 -1.88,1.16 -3.81,-0.38 -1.88,1.06 -1.2,3.73 -3.15,0.75 -2.59,2.8 -0.76,-0.21 -1.97,1.69 -0.97,-0.03 0.84,-2.36 -0.48,-1.85 -2.11,-0.51 -0.04,1.14 -1.18,-0.07 -1.58,-2.4 -3.28,-0.72 -3.11,-2.04 -0.12,-1.56 -1.18,-1.8 0.31,-4.71 0.8,-1.56 -0.54,-1.1 0.59,-5.09 -0.95,-2.39 -4.75,-3.08 -3.42,-0.92 -0.6,-2.1 -1.26,-0.18 -1.47,1.85 -2.07,0.96 -0.34,-1.08 -0.84,-0.17 -0.88,2.06 -0.82,-0.22 -0.4,0.98 -0.97,-0.39 -2.21,2.69 -2.12,0.01 -0.45,1.75 -1.6,-0.6 -0.31,1.3 -1.79,0.91 -4.85,-0.97 -3.17,3.31 -1.51,-0.27 -2.47,2.36 0,0 2.48,-9.04 5.12,-7.46 1.73,-4.37 0.08,-3.72 -1.39,-3.99 1.49,-4.48 6.74,-6.65 -0.34,-2.18 2.22,-7.29 -0.14,-2.12 -1.54,-3.6 -1.85,-2.18 -1.81,-0.87 -1.18,-3.95 0.47,-2.12 4.35,-4.85 0,0 5.81,1.44 2.91,1.84 3.07,0.83 2.02,-0.33 5.85,0.95 2.45,-3.71 0.03,-3.29 2.13,-0.94 2.52,0.53 6.4,-4.49 -0.65,-11.94 2.4,-2.26 3.2,-1.33 1.4,-3.58 3.03,-4.27 1.36,-4.24 2.21,-2.77 7.7,-0.77 0.24,-2.94 -2.78,-9.52 3.37,-2.7 1.45,-5.86 0,0 3.5,-1.19 2.48,-2.09 -1.37,-2.58 -0.57,-2.99 -2.75,-2.63 -0.64,-3.09 0.68,-6.62 2.3,-1.33 6.28,-6.41 0.92,0.69 0.02,1.84 3.45,5.24 -1.94,2.57 1.18,7.33 1.17,2.53 z"
            fill={getRegionColor("Janakpur")}
            className="hover:opacity-80 transition-opacity cursor-pointer"
          />
        </svg>

        {/* Overlay container for labels */}
        <div className="absolute inset-0">
          {data.map((region) => (
            <div
              key={region.region}
              className="absolute transform -translate-x-1/2 -translate-y-1/2 text-center"
              style={{
                left: labelPositions[region.region].x,
                top: labelPositions[region.region].y,
              }}
            >
              <div className="bg-card/80 rounded px-2 py-1 shadow-sm">
                <div className="text-xs font-bold sm:text-sm md:text-base">
                  {region.region}
                </div>
                <div className="text-xs sm:text-sm md:text-base font-semibold text-blue-600">
                  {(region.viewers / 1000).toFixed(0)}k
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
};

export default ViewershipMap;
